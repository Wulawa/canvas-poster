!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s={xhr(t){const e=window.XMLHttpRequest;return new Promise((i,s)=>{if(e)try{const n=new e;n.open("GET",t,!0),n.responseType="blob",n.withCredentials=!1,n.onload=(()=>{200==n.status?i(n.response):s(n)}),n.send(null)}catch(t){console.error(t),s(t)}else s("no xhr")})},blobtoImg(t){const e=new Image;return new Promise((i,s)=>{e.src=window.URL.createObjectURL(t),e.onload=(()=>{i(e)}),e.onerror=(t=>{s(t)})})},async loader(t,e){const i=await Promise.all(t.map(t=>this.xhr(t)));return e?await Promise.all(i.map(t=>this.blobtoImg(t))):i}};class n{constructor(){}loadByUrl(t,e){return s.loader(t,e)}}class a{constructor(t,e={square:!0}){this.canvas=document.createElement("canvas");const i=this.canvas.getContext("2d"),{width:s,height:n}=t,{w:a,h:h,square:r}=e;let c,o,l,d,u,x;if(r){const t=Math.min(s,n);u=a||t,x=h||t,this.canvas.width=t,this.canvas.height=t,c=t,o=t,l=(s-t)/2,d=(n-t)/2}else u=a||s,x=h||n,this.canvas.width=u,this.canvas.height=x,c=s,o=n,l=0,d=0;const g={x:u/2,y:x/2,r:Math.min(u,x)/2};i.arc(g.x,g.y,g.r,0,2*Math.PI,!1),i.clip(),i.drawImage(t,l,d,c,o,0,0,u,x)}getCanvas(){return this.canvas}}class h{constructor(t,e={}){this.canvas=document.createElement("canvas");const i=this.canvas.getContext("2d"),{width:s,height:n}=t,{padding:a}=e;this.canvas.width=s-2*a,this.canvas.height=n-2*a,i.drawImage(t,a,a,this.canvas.width,this.canvas.height,0,0,this.canvas.width,this.canvas.height)}getCanvas(){return this.canvas}}class r{constructor(){}}class c{constructor(t,e){this.text=String(t),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");const{devicePixelRatio:i,maxWidth:s,fontSize:n,fontFamily:a,fontWeight:h,lineHeight:r,textAlign:c,fillStyle:o,maxLines:l,lastLineCenter:d}=e;this.lastLineCenter=d,this.devicePixelRatio=i||1,this.maxLines=l||6,this.maxWidth=s||100,this.maxWidth=this.devicePixelRatio*this.maxWidth,this.canvas.width=this.maxWidth,this.canvas.height=10*this.canvas.width,this.lineHeight=r||1.2,n&&a&&h?(this.fontSize=n,i>2&&(this.fontSize*=i/2),this.ctx.font=`${h} ${this.fontSize}px ${a}`):console.error("params error"),o&&(this.ctx.fillStyle=o),c&&(this.ctx.textAlign=c),this.draw()}draw(){let t=1;this.devicePixelRatio>2&&(t=2/this.devicePixelRatio);let e=0,i=.85*this.fontSize;const s=this.lineHeight*this.fontSize*t,n=this.measureText(),a=n.length;for(let t=0;t<a;t++){const h=n[t];if(this.lastLineCenter&&t==a-1){const n=this.ctx.measureText(h).width;e=this.maxWidth/2-n/2,this.ctx.fillText(h,e,i+t*s,this.maxWidth)}else this.ctx.fillText(h,e,i+t*s,this.maxWidth)}this.maxHeight=a*s+i,1==a&&(this.maxWidth=this.ctx.measureText(this.text).width)}measureText(){const t=this.text,e=this.maxWidth,i=this.maxLines-1,s=this.ctx,n=[],a=t.length;let h="",r="",c=0,o=!1,l=1;for(;;){if(h=t.substr(c,l),c+l>a){n.push(h);break}if(s.measureText(h).width>e){if(c+=l-1,o||0===i){n.push(r.substr(0,r.length-3)+"...");break}n.push(r),n.length==i&&(o=!0),l=1}else r=h,l++}return n}getCanvas(){const t=document.createElement("canvas");return t.width=this.maxWidth,t.height=this.maxHeight,t.getContext("2d").drawImage(this.canvas,0,0,t.width,t.height,0,0,t.width,t.height),t}}i.d(e,"ImageCircle",function(){return a}),i.d(e,"ImageClip",function(){return h});e.default=class{constructor(t,e){this.image=new n,this.text=new r,this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}async loadImgByUrl(t,e){return this.image.loadByUrl(t,e)}setBackground(t){this.bgImg=t,this.drawBackground()}drawBackground(){this.ctx.clearRect(0,0,this.width,this.height),this.bgImg&&this.ctx.drawImage(this.bgImg,0,0,this.width,this.height,0,0,this.width,this.height)}drawRoundRect(t,e,i,s,n,a){this.ctx.beginPath(),this.ctx.arc(t+n,e+n,n,Math.PI,3*Math.PI/2),this.ctx.lineTo(i-n+t,e),this.ctx.arc(i-n+t,n+e,n,3*Math.PI/2,2*Math.PI),this.ctx.lineTo(i+t,s+e-n),this.ctx.arc(i-n+t,s-n+e,n,0,1*Math.PI/2),this.ctx.lineTo(n+t,s+e),this.ctx.arc(n+t,s-n+e,n,1*Math.PI/2,Math.PI),this.ctx.closePath(),this.ctx.fillStyle=a||"#fff",this.ctx.fill()}addImg(t,e){const{width:i,height:s}=t,{x:n,y:a,w:h,h:r,centerx:c,centery:o}=e,l=h||i,d=r||s;let u=n,x=a;c&&(u=this.width/2-l/2),o&&(x=this.height/2-d/2),this.ctx.drawImage(t,u,x,l,d)}addText(t,e,i){const s=new c(t,e),n=s.getCanvas();return this.addImg(n,i),s}getImg(){return this.canvas}}}])});